# 16.2. Multi Tenant Design

Canonical documentation for 16.2. Multi Tenant Design. This document defines concepts, terminology, and standard usage.

## Purpose
Multi-tenant design addresses the architectural requirement of serving multiple distinct groups of users (tenants) from a single software instance or a shared infrastructure pool. The primary objective is to maximize resource efficiency and simplify operational maintenance while ensuring that each tenant’s data and configurations remain isolated and secure from others.

This design paradigm solves the problem of linear cost scaling associated with single-tenant deployments. By consolidating resources, organizations can achieve economies of scale, streamline the deployment of updates, and provide a unified management interface for diverse client bases.

> [!NOTE]
> This documentation is intended to be implementation-agnostic and authoritative, focusing on the architectural principles rather than specific cloud provider services or programming frameworks.

## Scope
This documentation covers the theoretical frameworks, isolation strategies, and structural patterns necessary to design a robust multi-tenant system.

> [!IMPORTANT]
> **In scope:**
> * Data isolation strategies (Logical vs. Physical)
> * Resource allocation and "Noisy Neighbor" mitigation
> * Tenant lifecycle management (Provisioning and De-provisioning)
> * Security boundaries and identity context

> [!WARNING]
> **Out of scope:**
> * Specific vendor implementations (e.g., AWS SaaS Boost, Azure SQL Elastic Pools)
> * Front-end UI/UX design for tenant branding
> * Pricing and billing business logic

## Definitions
| Term | Definition |
|------|------------|
| Tenant | A discrete group of users who share a common access point and specific privileges to a software instance. |
| Isolation | The technical boundary that prevents one tenant from accessing, modifying, or impacting the performance of another tenant's data. |
| Noisy Neighbor | A phenomenon where one tenant consumes a disproportionate amount of shared resources, negatively impacting the performance of others. |
| Provisioning | The automated process of preparing and configuring resources for a new tenant. |
| Tenant Context | The metadata associated with a request that identifies the tenant and governs access control throughout the execution stack. |
| Tiering | The practice of offering different levels of isolation or resource guarantees based on a tenant's service level agreement (SLA). |

## Core Concepts
The fundamental idea of multi-tenancy is the balance between **Efficiency** and **Isolation**.

**The Isolation Continuum**
Multi-tenancy is not a binary state but a spectrum. At one end, "Shared Everything" maximizes cost-efficiency but increases the risk of cross-tenant interference. At the other end, "Shared Nothing" (Siloed) maximizes security and performance predictability but increases operational overhead and cost.

**Tenant Context Propagation**
A core requirement is the ability of the system to maintain "Tenant Awareness" across all layers—from the API gateway and application logic to the database and logging subsystems. This is typically achieved by injecting a Tenant ID into the execution context of every request.

> [!TIP]
> Use the "Apartment Building" analogy to clarify multi-tenancy: The building (infrastructure) and utilities (shared services) are shared, but each resident has their own key (identity) and private unit (data isolation). A "Silo" model is more like a row of detached houses—shared street (network) but entirely separate structures.

## Standard Model
The standard model for multi-tenant design categorizes isolation into three primary layers:

1.  **Application Layer Isolation:** The application code is shared. Logic must be written to filter data based on the Tenant ID present in the request context.
2.  **Data Layer Isolation:** This is the most critical component, usually following one of three patterns:
    *   **Discriminator Column:** All tenants share the same tables; rows are distinguished by a `tenant_id`.
    *   **Schema Separation:** Tenants share a database instance but have unique schemas.
    *   **Database Separation:** Each tenant has a dedicated physical or logical database instance.
3.  **Infrastructure Layer Isolation:** Determining if compute resources (containers, VMs) are shared or if high-value tenants receive dedicated hardware.

## Common Patterns
*   **The Bridge Model (Hybrid):** Using shared infrastructure for the application tier but dedicated databases for the data tier to satisfy regulatory or performance requirements.
*   **Cell-Based Architecture:** Grouping a subset of tenants into "cells" (complete stacks of the application). This limits the blast radius of a failure to only the tenants within that specific cell.
*   **Sidecar Tenant Context:** Using a sidecar pattern or middleware to intercept requests and validate tenant membership before the request reaches the core business logic.

## Anti-Patterns
*   **Hardcoded Tenant Logic:** Embedding tenant-specific `IF/ELSE` statements in the business logic. This makes the system unmaintainable as the number of tenants grows.
*   **Manual Provisioning:** Relying on human intervention to create databases or configure networking for new tenants, which leads to configuration drift and scaling bottlenecks.
*   **Cross-Tenant Joins:** Designing database queries that allow for the possibility of joining data across tenant boundaries, which is a primary source of data leaks.
*   **Ignoring Resource Quotas:** Failing to implement rate limiting or throttling at the tenant level, allowing a single tenant to crash the entire system.

> [!CAUTION]
> Avoid circular dependencies where the tenant-discovery service depends on a resource that requires a tenant context to function. This creates a "chicken-and-egg" failure scenario during system startup.

## Edge Cases
*   **The "Whale" Tenant:** A single tenant that is orders of magnitude larger than others. These often require "sharding" or moving from a shared model to a dedicated silo model to prevent them from overwhelming shared infrastructure.
*   **Tenant Migration:** The process of moving a tenant from a shared database to a dedicated one (or vice versa) without downtime.
*   **Cross-Tenant Collaboration:** Scenarios where Tenant A needs to explicitly share a specific resource with Tenant B (e.g., a shared document). This requires a sophisticated permissions model that transcends basic tenant isolation.
*   **Global vs. Regional Tenants:** Handling tenants that have data residency requirements in specific geographic locations while maintaining a single global management plane.

## Related Topics
*   **16.1. Identity and Access Management (IAM):** The foundation for identifying which tenant a user belongs to.
*   **17.4. Database Sharding:** Techniques for horizontal scaling that often overlap with multi-tenant data partitioning.
*   **12.2. Observability and Logging:** The necessity of tagging all logs and metrics with a Tenant ID for troubleshooting.

## Change Log
| Version | Date | Description |
|---------|------|-------------|
| 1.0 | 2026-02-17 | Initial AI-generated canonical documentation |